(()=>{"use strict";var e={731:(e,t,s)=>{e.exports=s.p+"a9554c2ed151027c7faa.js"},693:(e,t,s)=>{e.exports=s.p+"586b1efc8435ee826786.wasm"}},t={};function s(i){var n=t[i];if(void 0!==n)return n.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,s),r.exports}s.m=e,s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var i=t.getElementsByTagName("script");i.length&&(e=i[i.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href,(()=>{function e(e){"suspended"===e.state&&e.resume()}function t(e,t){const s=e.exports.stackAlloc(t.length);return new Int8Array(e.exports.memory.buffer).set(t,s),s}function i(e,s){return t(e,(s+"\0").split("").map((e=>e.charCodeAt(0))))}const n=16384;class r{constructor(e,t){this.destroyed=!1,this.audioContext=e,this.instance=t}selectProfile(e,t){const s=this.instance.exports.stackSave(),r=i(this.instance,JSON.stringify({profile:e})),o=i(this.instance,"profile"),a=this.instance.exports.quiet_encoder_profile_str(r,o);return this.encoder=this.instance.exports.quiet_encoder_create(a,this.audioContext.sampleRate),this.instance.exports.free(a),this.frameLength=t?this.instance.exports.quiet_encoder_clamp_frame_len(this.encoder,n):this.instance.exports.quiet_encoder_get_frame_len(this.encoder),this.samples=function(e,t){const s=t.exports.malloc(65536);return{pointer:s,view:new Float32Array(t.exports.memory.buffer).subarray(s/4,s/4+16384)}}(0,this.instance),this.instance.exports.stackRestore(s),this}async transmit(s){const i=this.instance.exports.stackSave();e(this.audioContext);const r=function(e,t){const s=[];for(let i=0;i<e.byteLength;i+=t){const n=e.slice(i,i+t);s.push(n)}return s}(s,this.frameLength);let o=this.audioContext.currentTime;for(const e of r){const s=this.audioContext.createBuffer(1,n,this.audioContext.sampleRate),i=t(this.instance,new Uint8Array(e));this.instance.exports.quiet_encoder_send(this.encoder,i,e.byteLength);for(let e=this.instance.exports.quiet_encoder_emit(this.encoder,this.samples.pointer,n);e<n;e+=1)this.samples.view[e]=0;s.copyToChannel(this.samples.view,0,0);const r=new AudioBufferSourceNode(this.audioContext);r.buffer=s,r.connect(this.audioContext.destination),r.start(o),o+=s.duration}var a;return this.instance.exports.stackRestore(i),await(a=o-this.audioContext.currentTime,new Promise((e=>setTimeout(e,1e3*a)))),this}destroy(){return this.destroyed||(this.instance.exports.free(this.samples.pointer),this.instance.exports.quiet_encoder_destroy(this.encoder),this.destroyed=!0),this}}var o={env:{__sys_getpid:()=>null},wasi_snapshot_preview1:{proc_exit:()=>null,clock_time_get:()=>null,fd_close:()=>null,fd_write:()=>null,fd_seek:()=>null,fd_read:()=>null}},a={checksum_scheme:"crc32",inner_fec_scheme:"v27",outer_fec_scheme:"none",mod_scheme:"gmsk",frame_length:25,modulation:{center_frequency:4200,gain:.15},interpolation:{shape:"kaiser",samples_per_symbol:10,symbol_delay:4,excess_bandwidth:.35},encoder_filters:{dc_filter_alpha:.01},resampler:{delay:13,bandwidth:.45,attenuation:60,filter_bank_size:64}};const c=new AudioContext;!async function(){const t=await new class{constructor(e,t){this.audioContext=e,this.profile=t}async init(){if(this.quietWasmBytes=await fetch(new URL(s(693),s.b)).then((e=>e.arrayBuffer())),this.instance=(await WebAssembly.instantiate(this.quietWasmBytes,o)).instance,"undefined"!=typeof window){const{audioWorklet:e}=this.audioContext;await e.addModule(new URL(s(731),s.b)),this.quietProcessorNode=new AudioWorkletNode(this.audioContext,"quiet-processor-node",{processorOptions:{quietWasmBytes:this.quietWasmBytes,profile:this.profile,sampleRate:this.audioContext.sampleRate}})}return this}async transmit({payload:e,clampFrame:t}){var s;(await new r(this.audioContext,this.instance).selectProfile(this.profile,t).transmit((s=e,(new TextEncoder).encode(s)))).destroy()}async receive(t){this.audioStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1}}),this.audioContext.createMediaStreamSource(this.audioStream).connect(this.quietProcessorNode).port.onmessage=e=>t(e.data),e(this.audioContext)}}(c,a).init();document.querySelector("#audible-text").addEventListener("submit",(e=>{const{value:s}=e.target.querySelector("textarea");var i;i=s,t.transmit({clampFrame:!1,payload:i}),e.preventDefault()}));const i=document.querySelector("#received-text");document.querySelector("#start-listening").addEventListener("click",(()=>{t.receive((e=>{i.innerHTML+=e.value}))}))}()})()})();