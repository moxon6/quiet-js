("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire9a78.register("3aEz3",(function(e,t){function s(e,t){return function(e,t){const s=e.exports.stackAlloc(t.length);return new Int8Array(e.exports.memory.buffer).set(t,s),s}(e,(t+"\0").split("").map((e=>e.charCodeAt(0))))}class i{constructor(e,t){this._readIndex=0,this._writeIndex=0,this._framesAvailable=0,this._channelCount=t,this._length=e,this._channelData=[];for(let t=0;t<this._channelCount;t+=1)this._channelData[t]=new Float32Array(e)}get framesAvailable(){return this._framesAvailable}push(e){const t=e[0].length;for(let s=0;s<t;s+=1){const t=(this._writeIndex+s)%this._length;for(let i=0;i<this._channelCount;i+=1)this._channelData[i][t]=e[i][s]}this._writeIndex+=t,this._writeIndex>=this._length&&(this._writeIndex=0),this._framesAvailable+=t,this._framesAvailable>this._length&&(this._framesAvailable=this._length)}pull(e){if(0===this._framesAvailable)return;const t=e[0].length;for(let s=0;s<t;s+=1){const t=(this._readIndex+s)%this._length;for(let i=0;i<this._channelCount;i+=1)e[i][s]=this._channelData[i][t]}this._readIndex+=t,this._readIndex>=this._length&&(this._readIndex=0),this._framesAvailable-=t,this._framesAvailable<0&&(this._framesAvailable=0)}}var r={env:{__sys_getpid:()=>null},wasi_snapshot_preview1:{proc_exit:()=>null,clock_time_get:()=>null,fd_close:()=>null,fd_write:()=>null,fd_seek:()=>null,fd_read:()=>null}};const n=16384;class a extends AudioWorkletProcessor{constructor(e){super();const{quietWasmBytes:t,profile:s,sampleRate:r}=e.processorOptions;this.quietWasmBytes=t,this.profile=s,this.sampleRate=r,this.inputRingBuffer=new i(n,1),this.init()}async init(){return this.instance=(await WebAssembly.instantiate(this.quietWasmBytes,r)).instance,await this.selectProfile(this.instance,this.profile),this}async selectProfile(e,t){const i=e.exports.stackSave(),r=s(e,JSON.stringify({profile:t})),a=s(e,"profile"),l=e.exports.quiet_decoder_profile_str(r,a);return this.decoder=e.exports.quiet_decoder_create(l,this.sampleRate),e.exports.free(l),e.exports.stackRestore(i),this.samples=function(e,t){const s=t.exports.malloc(4*e);return{pointer:s,view:new Float32Array(t.exports.memory.buffer).subarray(s/4,s/4+e)}}(n,this.instance),this.frame=e.exports.malloc(n),this}process(e,t){if(!e[0].length)return!0;const s=e[0],i=t[0][0];if(this.inputRingBuffer.push([...s]),this.inputRingBuffer.framesAvailable>=n){this.inputRingBuffer.pull([this.samples.view]),this.bufferIndex=0,this.instance.exports.quiet_decoder_consume(this.decoder,this.samples.pointer,n);const e=this.instance.exports.quiet_decoder_recv(this.decoder,this.frame,n);if(-1!==e){const t=new Int8Array(this.instance.exports.memory.buffer).slice(this.frame,this.frame+e),s=(r=t.buffer,[...new Uint8Array(r)].map((e=>String.fromCharCode(e))).join(""));this.port.postMessage({type:"payload",value:s})}}var r;return i.forEach((e=>{for(let t=0;t<e.length;t+=1)e[t]=1})),!0}}registerProcessor("quiet-processor-node",a)}));
//# sourceMappingURL=quiet.worklet.dd17454f.js.map
